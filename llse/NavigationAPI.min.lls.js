const pluginName="NavigationAPI",exportNamespace="NavAPI",tasks=new Map,{Red,Green,Aqua,White,LightPurple,Clear,MinecoinGold}=Format;function formatPos(pos){const{x,y,z,dimId}=pos;pos=(()=>{switch(dimId){case 0:return"主世界";case 1:return"地狱";case 2:return"末地";default:return"未知"}})();return""+Green+x.toFixed(2)+" "+Red+y.toFixed(2)+" "+Aqua+z.toFixed(2)+White+"， "+LightPurple+pos}function clearNavigationTask(xuid){const pl=mc.getPlayer(xuid);var taskId=tasks.get(xuid);return taskId?(clearInterval(taskId),tasks.delete(xuid),pl.tell(Green+"本次导航完成~欢迎下次使用~",5),!0):(pl.tell(Red+"没有导航进行中"),!1)}function hasNavigationTask(xuid){return!!tasks.get(xuid)}function newNavigationTask(xuid,warp){const tmpPl=mc.getPlayer(xuid);function formatXZPos(x,z){return""+Green+x.toFixed()+` ${Red}~ `+Aqua+z.toFixed()}if(hasNavigationTask(xuid))return tmpPl.tell(Red+"已有导航正在进行中，请先结束"),!1;tmpPl.tell(Green+"开始为您导航~"),tmpPl.tell(Green+"开始为您导航~",5);var taskId=setInterval(function(){const pl=mc.getPlayer(xuid),{x,y,z,dimid:dimId}=pl["pos"];var{pos,name}=warp;const{x:dx,y:dy,z:dz,dimId:dDim}=pos;var distance=Math.sqrt((x-dx)*(x-dx)+(y-dy)*(y-dy)+(z-dz)*(z-dz)).toFixed(2);let msg=""+Green+name+Clear+" | "+`${MinecoinGold}目标位置：${formatPos(pos)}${Clear} | `;if(dimId!==dDim)msg+=2===dimId||2===dDim?Red+"维度不匹配":1===dDim?MinecoinGold+"主世界坐标："+formatXZPos(8*dx,8*dz):0===dDim?MinecoinGold+"地狱坐标："+formatXZPos(dx/8,dz/8):Red+"非法导航";else{if(distance<=3)return void clearNavigationTask(pl.xuid);msg+=`${MinecoinGold}距离 ${Green}${distance} ${MinecoinGold}方块`}pl.tell(msg,5)},500);return tasks.set(xuid,taskId),!0}mc.listen("onLeft",pl=>clearNavigationTask(pl.xuid)),(()=>{const cmd=mc.newCommand("stopnav","停止导航",PermType.Any);cmd.setCallback((_,origin,out)=>origin.player?clearNavigationTask(origin.player.xuid):(out.error("该指令只能由玩家执行，请使用execute命令模拟目标玩家执行该指令"),!1)),cmd.overload(),cmd.setup()})(),ll.export(newNavigationTask,exportNamespace+"_newTask"),ll.export(clearNavigationTask,exportNamespace+"_clearTask"),ll.export(hasNavigationTask,exportNamespace+"_hasTask"),ll.registerPlugin(pluginName,"导航API",[0,1,2],{Author:"student_2333",License:"Apache-2.0"});